<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Firework City Tycoon</title>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-top: #0a0a1a;
            --bg-bot: #1a1a2e;
            --accent: #ff0055;
            --gold: #ffcc00;
            --ui-bg: rgba(255, 255, 255, 0.15);
        }
        body {
            margin: 0;
            overflow: hidden;
            background: linear-gradient(to bottom, var(--bg-top), var(--bg-bot));
            font-family: 'Fredoka One', cursive;
            touch-action: none;
            user-select: none;
        }
        canvas { display: block; }

        /* UI CAMADAS */
        #ui-layer {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        /* HUD SUPERIOR */
        .hud {
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
        }
        .money-box {
            background: rgba(0,0,0,0.5);
            padding: 10px 20px;
            border-radius: 30px;
            border: 2px solid var(--gold);
            color: var(--gold);
            font-size: 24px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .level-badge {
            color: white;
            font-size: 18px;
        }

        /* BOT√ïES E LOJA */
        .controls {
            pointer-events: auto;
            padding: 20px;
            background: linear-gradient(to top, rgba(0,0,0,0.9), transparent);
            display: flex;
            gap: 10px;
            overflow-x: auto;
            padding-bottom: 30px;
        }
        
        .btn-firework {
            background: var(--ui-bg);
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 15px;
            min-width: 80px;
            height: 80px;
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: transform 0.1s;
            position: relative;
        }
        .btn-firework:active { transform: scale(0.95); }
        .btn-firework.locked { opacity: 0.6; filter: grayscale(1); }
        .btn-firework.selected { border-color: var(--gold); background: rgba(255, 204, 0, 0.2); }
        
        .price-tag {
            font-size: 12px;
            background: var(--gold);
            color: black;
            padding: 2px 6px;
            border-radius: 10px;
            margin-top: 5px;
        }

        /* POPUPS DE TEXTO (Combo, Wow) */
        .floating-text {
            position: absolute;
            color: white;
            font-size: 20px;
            pointer-events: none;
            animation: floatUp 1s forwards;
            text-shadow: 0 0 10px currentColor;
        }

        @keyframes floatUp {
            0% { transform: translateY(0) scale(0.5); opacity: 0; }
            20% { transform: translateY(-20px) scale(1.2); opacity: 1; }
            100% { transform: translateY(-50px) scale(1); opacity: 0; }
        }

        /* MODAL DE BOAS VINDAS */
        #start-screen {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85);
            pointer-events: auto;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 100;
            color: white;
            text-align: center;
        }
        .big-btn {
            background: linear-gradient(45deg, #ff0055, #ffcc00);
            border: none;
            padding: 15px 40px;
            font-size: 24px;
            color: white;
            border-radius: 50px;
            font-family: inherit;
            margin-top: 20px;
            cursor: pointer;
            box-shadow: 0 0 20px rgba(255, 0, 85, 0.5);
            animation: pulse 1.5s infinite;
        }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }

    </style>
</head>
<body>

    <canvas id="canvas"></canvas>

    <div id="ui-layer">
        <div class="hud">
            <div class="money-box">üí∞ <span id="money-display">0</span></div>
            <div class="level-badge">LOJA DE FOGOS</div>
        </div>

        <div class="controls" id="shop-container">
            </div>
    </div>

    <div id="start-screen">
        <h1 style="font-size: 40px; color: var(--gold); margin-bottom: 10px;">FIREWORK CITY</h1>
        <p>Voc√™ √© o Diretor do Show!</p>
        <p style="font-size: 14px; opacity: 0.8;">Toque para ganhar dinheiro.<br>Compre cores e formatos novos.</p>
        <button class="big-btn" onclick="startGame()">COME√áAR O SHOW</button>
    </div>

<script>
/**
 * FIREWORK CITY TYCOON
 * Vers√£o 3.0 - Com Economia, Save Game e Desbloqueios
 */

// --- CONFIGURA√á√ÉO DO JOGO (DATA) ---
const GAME_DATA = {
    money: 0,
    unlocked: ['red'], // IDs dos itens desbloqueados
    selected: 'red'
};

// Cat√°logo da Loja
const SHOP_ITEMS = [
    { id: 'red', name: 'B√°sico Vermelho', color: '#ff3b30', shape: 'circle', price: 0 },
    { id: 'blue', name: 'Azul Cobalto', color: '#007aff', shape: 'circle', price: 50 },
    { id: 'gold', name: 'Chuva de Ouro', color: '#ffd700', shape: 'sparkle', price: 150 },
    { id: 'green', name: 'Estrela Verde', color: '#34c759', shape: 'star', price: 300 },
    { id: 'purple', name: 'Anel Duplo', color: '#af52de', shape: 'ring', price: 600 },
    { id: 'mega', name: 'MEGA BOMBA', color: '#ffffff', shape: 'mega', price: 1500 },
    { id: 'heart', name: 'Amor Rosa', color: '#ff2d55', shape: 'heart', price: 3000 },
    { id: 'random', name: 'Festa Mista', color: 'random', shape: 'random', price: 5000 }
];

// --- SISTEMA DE √ÅUDIO SINTETIZADO ---
const AudioSys = {
    ctx: null,
    init() {
        if (!this.ctx) this.ctx = new (window.AudioContext || window.webkitAudioContext)();
        if (this.ctx.state === 'suspended') this.ctx.resume();
    },
    playPop(vol = 1) {
        if (!this.ctx) return;
        const osc = this.ctx.createOscillator();
        const gain = this.ctx.createGain();
        osc.connect(gain);
        gain.connect(this.ctx.destination);
        
        osc.frequency.setValueAtTime(100 + Math.random()*50, this.ctx.currentTime);
        osc.frequency.exponentialRampToValueAtTime(40, this.ctx.currentTime + 0.1);
        
        gain.gain.setValueAtTime(0.2 * vol, this.ctx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.01, this.ctx.currentTime + 0.3);
        
        osc.start();
        osc.stop(this.ctx.currentTime + 0.3);
    },
    playCoin() {
        if (!this.ctx) return;
        const osc = this.ctx.createOscillator();
        const gain = this.ctx.createGain();
        osc.type = 'triangle';
        osc.connect(gain);
        gain.connect(this.ctx.destination);
        osc.frequency.setValueAtTime(1200, this.ctx.currentTime);
        osc.frequency.setValueAtTime(1600, this.ctx.currentTime + 0.1);
        gain.gain.setValueAtTime(0.05, this.ctx.currentTime);
        gain.gain.linearRampToValueAtTime(0, this.ctx.currentTime + 0.2);
        osc.start();
        osc.stop(this.ctx.currentTime + 0.2);
    }
};

// --- ENGINE GR√ÅFICA ---
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d', { alpha: false }); // Otimiza√ß√£o
let W, H;
let particles = [];

function resize() {
    W = canvas.width = window.innerWidth;
    H = canvas.height = window.innerHeight;
}
window.addEventListener('resize', resize);
resize();

// Classe Part√≠cula
class Particle {
    constructor(x, y, color, type, speedMulti = 1) {
        this.x = x;
        this.y = y;
        this.color = color;
        
        // F√≠sica
        const angle = Math.random() * Math.PI * 2;
        let speed = Math.random() * 5 + 2;
        
        // Comportamentos por tipo
        this.friction = 0.96;
        this.gravity = 0.15;
        this.life = 1.0;
        this.decay = Math.random() * 0.015 + 0.01;

        if (type === 'sparkle') { this.friction = 0.92; speed *= 1.5; }
        if (type === 'mega') { speed *= 2.5; this.decay = 0.005; }

        this.vx = Math.cos(angle) * speed * speedMulti;
        this.vy = Math.sin(angle) * speed * speedMulti;
    }

    update() {
        this.vx *= this.friction;
        this.vy *= this.friction;
        this.vy += this.gravity;
        this.x += this.vx;
        this.y += this.vy;
        this.life -= this.decay;
    }

    draw() {
        ctx.globalAlpha = Math.max(0, this.life);
        ctx.fillStyle = this.color;
        ctx.beginPath();
        ctx.arc(this.x, this.y, 2.5, 0, Math.PI * 2);
        ctx.fill();
    }
}

// Gerador de Formatos
function createExplosion(x, y, item) {
    const color = item.color === 'random' ? `hsl(${Math.random()*360}, 100%, 50%)` : item.color;
    const shape = item.shape === 'random' ? ['circle','star','ring'][Math.floor(Math.random()*3)] : item.shape;
    
    // Som
    AudioSys.playPop(shape === 'mega' ? 3 : 1);

    // Recompensa em dinheiro
    addMoney(shape === 'mega' ? 15 : 5);
    showFloatingText(`+$${shape === 'mega' ? 15 : 5}`, x, y - 50);

    // L√≥gica dos formatos
    if (shape === 'circle' || shape === 'sparkle' || shape === 'random') {
        for(let i=0; i<60; i++) particles.push(new Particle(x, y, color, shape));
    }
    else if (shape === 'mega') {
        for(let i=0; i<200; i++) particles.push(new Particle(x, y, color, shape));
        // Flash branco
        ctx.fillStyle = 'white'; ctx.globalAlpha = 0.5; ctx.fillRect(0,0,W,H);
    }
    else if (shape === 'star') {
        for(let i=0; i<80; i++) {
            const p = new Particle(x, y, color, 'circle');
            // Matem√°tica da estrela (simplificada para velocidade)
            const a = (i / 80) * Math.PI * 2;
            const r = (i % 2 === 0) ? 3 : 8; // Pontas
            p.vx = Math.cos(a) * r; p.vy = Math.sin(a) * r;
            particles.push(p);
        }
    }
    else if (shape === 'ring') {
        for(let i=0; i<80; i++) {
            const p = new Particle(x, y, color, 'circle');
            const a = (i / 80) * Math.PI * 2;
            const s = 6;
            p.vx = Math.cos(a) * s; p.vy = Math.sin(a) * s;
            particles.push(p);
        }
    }
    else if (shape === 'heart') {
        for (let i = 0; i < 80; i++) {
            const t = (i / 80) * Math.PI * 2;
            const xx = 16 * Math.pow(Math.sin(t), 3);
            const yy = 13 * Math.cos(t) - 5 * Math.cos(2 * t) - 2 * Math.cos(3 * t) - Math.cos(4 * t);
            const p = new Particle(x, y, color, 'circle');
            p.vx = xx * 0.3; p.vy = -yy * 0.3;
            particles.push(p);
        }
    }
}

// --- LOOP PRINCIPAL ---
function loop() {
    requestAnimationFrame(loop);

    // Fundo com efeito rastro e cidade
    ctx.globalCompositeOperation = 'source-over';
    ctx.fillStyle = 'rgba(10, 10, 26, 0.2)'; // Rastro
    ctx.fillRect(0, 0, W, H);

    // Desenhar Cidade (Cityline Simples)
    ctx.fillStyle = '#050510';
    ctx.fillRect(0, H - 50, W, 50);
    // Pr√©dios simples
    for(let i=0; i<W; i+=40) {
        const h = Math.sin(i)*20 + 60;
        ctx.fillRect(i, H-h, 42, h);
    }

    // Part√≠culas
    ctx.globalCompositeOperation = 'lighter';
    for (let i = particles.length - 1; i >= 0; i--) {
        particles[i].update();
        particles[i].draw();
        if (particles[i].life <= 0) particles.splice(i, 1);
    }
}

// --- UI & GAMEPLAY ---
function startGame() {
    document.getElementById('start-screen').style.display = 'none';
    AudioSys.init();
    loadGame();
    renderShop();
    loop();
}

function addMoney(amount) {
    GAME_DATA.money += amount;
    updateHUD();
    saveGame();
    if(Math.random() > 0.7) AudioSys.playCoin();
}

function updateHUD() {
    const el = document.getElementById('money-display');
    // Efeito visual de contar dinheiro
    el.innerText = GAME_DATA.money;
}

function showFloatingText(text, x, y) {
    const el = document.createElement('div');
    el.className = 'floating-text';
    el.innerText = text;
    el.style.left = x + 'px';
    el.style.top = y + 'px';
    // Cor din√¢mica baseada no contexto
    if(text.includes('!')) el.style.color = '#ffcc00';
    document.body.appendChild(el);
    setTimeout(() => el.remove(), 1000);
}

// Renderiza a Loja
function renderShop() {
    const container = document.getElementById('shop-container');
    container.innerHTML = '';

    SHOP_ITEMS.forEach(item => {
        const btn = document.createElement('div');
        const unlocked = GAME_DATA.unlocked.includes(item.id);
        
        btn.className = `btn-firework ${unlocked ? '' : 'locked'} ${GAME_DATA.selected === item.id ? 'selected' : ''}`;
        
        // Conte√∫do Visual do Bot√£o
        let icon = '‚óè';
        if(item.shape === 'star') icon = '‚òÖ';
        if(item.shape === 'heart') icon = '‚ô•';
        if(item.shape === 'ring') icon = '‚óé';
        if(item.shape === 'mega') icon = '‚òÄ';

        btn.innerHTML = `
            <span style="font-size: 24px; color: ${item.color === 'random' ? 'white' : item.color}">${icon}</span>
            <span style="font-size: 10px; margin-top:5px">${unlocked ? item.name : 'Bloqueado'}</span>
            ${!unlocked ? `<div class="price-tag">$${item.price}</div>` : ''}
        `;

        btn.onclick = (e) => {
            e.stopPropagation();
            if (unlocked) {
                GAME_DATA.selected = item.id;
                renderShop(); // Atualiza sele√ß√£o visual
                AudioSys.playCoin(); // Som de click
            } else {
                if (GAME_DATA.money >= item.price) {
                    // Comprar
                    GAME_DATA.money -= item.price;
                    GAME_DATA.unlocked.push(item.id);
                    GAME_DATA.selected = item.id;
                    AudioSys.playCoin();
                    showFloatingText("COMPRADO!", e.clientX, e.clientY);
                    saveGame();
                    renderShop();
                    updateHUD();
                } else {
                    // Sem dinheiro
                    showFloatingText("Dinheiro insuficiente!", e.clientX, e.clientY);
                    btn.style.transform = "translateX(5px)";
                    setTimeout(()=> btn.style.transform = "none", 100);
                }
            }
        };

        container.appendChild(btn);
    });
}

// --- PERSIST√äNCIA (SAVE) ---
function saveGame() {
    localStorage.setItem('firework_tycoon_v1', JSON.stringify(GAME_DATA));
}

function loadGame() {
    const saved = localStorage.getItem('firework_tycoon_v1');
    if (saved) {
        const parsed = JSON.parse(saved);
        // Merge seguro caso adicionemos itens novos no futuro
        GAME_DATA.money = parsed.money || 0;
        GAME_DATA.unlocked = parsed.unlocked || ['red'];
    }
    updateHUD();
}

// Input Global
window.addEventListener('pointerdown', (e) => {
    // Ignora cliques na UI
    if (e.target.closest('#ui-layer')) return;
    
    const currentItem = SHOP_ITEMS.find(i => i.id === GAME_DATA.selected);
    createExplosion(e.clientX, e.clientY, currentItem);
});

</script>
</body>
</html>
