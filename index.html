<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Firework Station 2.0</title>
    <style>
        :root {
            --bg-color: #050510;
            --glass: rgba(255, 255, 255, 0.1);
            --border: rgba(255, 255, 255, 0.2);
            --accent: #00d2ff;
        }
        body {
            margin: 0;
            overflow: hidden;
            background-color: var(--bg-color);
            font-family: 'Segoe UI', sans-serif;
            touch-action: none; /* Remove zoom no toque */
        }
        canvas {
            display: block;
            width: 100vw;
            height: 100vh;
        }
        
        /* UI - Barra Inferior Flutuante */
        #ui-layer {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 15px;
            padding: 12px 20px;
            background: var(--glass);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: 20px;
            border: 1px solid var(--border);
            box-shadow: 0 8px 32px rgba(0,0,0,0.5);
            z-index: 10;
            width: max-content;
        }

        .btn {
            background: rgba(0,0,0,0.3);
            border: 1px solid var(--border);
            color: white;
            padding: 10px 16px;
            border-radius: 12px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn:active { transform: scale(0.95); }
        .btn:hover { background: rgba(255,255,255,0.1); border-color: white; }
        
        .btn-primary {
            background: linear-gradient(135deg, #ff00cc, #333399);
            border: none;
            box-shadow: 0 0 15px rgba(255, 0, 204, 0.4);
        }

        .btn-auto.active {
            background: #00d2ff;
            box-shadow: 0 0 15px rgba(0, 210, 255, 0.6);
            color: #000;
        }

        /* Dica de Mute/Unmute */
        #mute-hint {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            color: rgba(255,255,255,0.6);
            font-size: 12px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 1s;
        }
    </style>
</head>
<body>

    <div id="mute-hint">Toque na tela para ativar o √°udio</div>
    
    <div id="ui-layer">
        <button class="btn" id="btn-mix">üé® Misturar</button>
        <button class="btn btn-auto" id="btn-auto">üöÄ Auto</button>
        <button class="btn btn-primary" id="btn-big">üí• MEGA</button>
    </div>

    <canvas id="canvas"></canvas>

<script>
/* * FIREWORK STATION 2.0
 * Audio Synthesis + Physics Engine
 */

// --- M√ìDULO DE √ÅUDIO (Sintetizador) ---
const AudioSys = {
    ctx: null,
    enabled: false,
    
    init() {
        if (!this.ctx) {
            this.ctx = new (window.AudioContext || window.webkitAudioContext)();
            this.enabled = true;
            
            // Cria um buffer de ru√≠do branco (para explos√µes)
            const bufferSize = this.ctx.sampleRate * 2; // 2 segundos
            this.noiseBuffer = this.ctx.createBuffer(1, bufferSize, this.ctx.sampleRate);
            const data = this.noiseBuffer.getChannelData(0);
            for (let i = 0; i < bufferSize; i++) {
                data[i] = Math.random() * 2 - 1;
            }
        }
        if (this.ctx.state === 'suspended') {
            this.ctx.resume();
        }
    },

    playLaunch() {
        if (!this.enabled) return;
        const osc = this.ctx.createOscillator();
        const gain = this.ctx.createGain();
        
        osc.connect(gain);
        gain.connect(this.ctx.destination);
        
        // Som de "fiuuu" (Sobe frequ√™ncia)
        osc.type = 'sine';
        osc.frequency.setValueAtTime(200, this.ctx.currentTime);
        osc.frequency.exponentialRampToValueAtTime(800, this.ctx.currentTime + 0.5);
        
        gain.gain.setValueAtTime(0.1, this.ctx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.01, this.ctx.currentTime + 0.4);
        
        osc.start();
        osc.stop(this.ctx.currentTime + 0.5);
    },

    playExplosion(size = 1) {
        if (!this.enabled) return;
        const src = this.ctx.createBufferSource();
        src.buffer = this.noiseBuffer;
        
        const filter = this.ctx.createBiquadFilter();
        filter.type = 'lowpass';
        filter.frequency.value = 800; // Som abafado de explos√£o

        const gain = this.ctx.createGain();
        
        src.connect(filter);
        filter.connect(gain);
        gain.connect(this.ctx.destination);
        
        // Volume baseado no tamanho da explos√£o
        const vol = Math.min(0.5, 0.1 * size);
        const duration = 0.5 + (size * 0.2);

        gain.gain.setValueAtTime(vol, this.ctx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.001, this.ctx.currentTime + duration);
        
        src.start();
        src.stop(this.ctx.currentTime + duration);
    }
};

// --- CONFIGURA√á√ïES E VARI√ÅVEIS ---
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
let W, H;
let particles = [];
let autoMode = false;
let lastAutoTime = 0;

// Ajuste de tela
function resize() {
    W = canvas.width = window.innerWidth;
    H = canvas.height = window.innerHeight;
}
window.addEventListener('resize', resize);
resize();

// Paleta Neon
const COLORS = [
    '#ff0055', '#00ddff', '#ffdd00', '#aa00ff', '#00ff55', '#ffffff', '#ff8800'
];

// --- SISTEMA DE PART√çCULAS ---
class Particle {
    constructor(x, y, color, type = 'spark') {
        this.x = x;
        this.y = y;
        this.color = color;
        this.type = type;
        
        // F√≠sica inicial
        const angle = Math.random() * Math.PI * 2;
        // Velocidade aleat√≥ria para criar a esfera
        const speed = Math.random() * (type === 'trail' ? 2 : 15); 
        
        this.vx = Math.cos(angle) * speed;
        this.vy = Math.sin(angle) * speed;
        
        this.friction = 0.95; // Atrito do ar (segredo do realismo)
        this.gravity = 0.2;
        this.alpha = 1;
        this.decay = Math.random() * 0.015 + 0.01;
    }

    update() {
        this.vx *= this.friction;
        this.vy *= this.friction;
        this.vy += this.gravity;
        
        this.x += this.vx;
        this.y += this.vy;
        this.alpha -= this.decay;
    }

    draw(ctx) {
        ctx.save();
        ctx.globalAlpha = this.alpha;
        ctx.fillStyle = this.color;
        
        // Brilho intenso (Addictive blending)
        ctx.globalCompositeOperation = 'lighter';
        
        ctx.beginPath();
        ctx.arc(this.x, this.y, 2, 0, Math.PI * 2);
        ctx.fill();
        
        ctx.restore();
    }
}

// --- L√ìGICA DE EXPLOS√ÉO ---
function explode(x, y, colorOverride = null, size = 1) {
    const color = colorOverride || COLORS[Math.floor(Math.random() * COLORS.length)];
    const particleCount = 80 * size;
    
    AudioSys.playExplosion(size);

    for (let i = 0; i < particleCount; i++) {
        const p = new Particle(x, y, color);
        
        // Modificadores para variar os formatos
        if(size > 1.5) { 
            p.vx *= 1.5; p.vy *= 1.5; // Explos√£o maior
        }
        particles.push(p);
    }
}

function launchFirework(targetX, targetY, color) {
    // Simulando o lan√ßamento (simplificado: cria o som e agenda a explos√£o)
    AudioSys.playLaunch();
    
    // Delay visual para "chegar" ao topo (opcional, aqui fiz instant√¢neo para arcade feel)
    // Mas vamos fazer um pequeno delay aleat√≥rio para o modo auto ficar natural
    setTimeout(() => {
        explode(targetX, targetY, color, 1);
    }, 100); // Pequeno atraso para sincronizar com o pico do som
}

// --- LOOP DO JOGO ---
function loop() {
    // Efeito de rastro: desenha um fundo semitransparente
    ctx.globalCompositeOperation = 'source-over';
    ctx.fillStyle = 'rgba(5, 5, 16, 0.2)'; 
    ctx.fillRect(0, 0, W, H);

    // Atualiza e desenha part√≠culas
    for (let i = particles.length - 1; i >= 0; i--) {
        const p = particles[i];
        p.update();
        p.draw(ctx);
        if (p.alpha <= 0) particles.splice(i, 1);
    }

    // Modo Autom√°tico
    if (autoMode) {
        const now = Date.now();
        if (now - lastAutoTime > 800) { // A cada 800ms
            const x = Math.random() * W * 0.8 + W * 0.1;
            const y = Math.random() * H * 0.5 + H * 0.1;
            launchFirework(x, y, null);
            lastAutoTime = now;
        }
    }

    requestAnimationFrame(loop);
}

// --- CONTROLES E INTERA√á√ÉO ---
canvas.addEventListener('pointerdown', (e) => {
    AudioSys.init(); // Ativa audio no primeiro clique
    explode(e.clientX, e.clientY);
});

// Bot√£o Mix (Cor Aleat√≥ria Especial)
document.getElementById('btn-mix').addEventListener('click', (e) => {
    e.stopPropagation();
    AudioSys.init();
    const x = W / 2;
    const y = H / 3;
    // Explos√£o dupla
    explode(x, y, '#fff', 1);
    setTimeout(() => explode(x, y, '#ff0055', 1.2), 150);
});

// Bot√£o Mega
document.getElementById('btn-big').addEventListener('click', (e) => {
    e.stopPropagation();
    AudioSys.init();
    explode(W/2, H/2, '#ffd700', 2.5); // Explos√£o gigante dourada
});

// Bot√£o Auto
const btnAuto = document.getElementById('btn-auto');
btnAuto.addEventListener('click', (e) => {
    e.stopPropagation();
    AudioSys.init();
    autoMode = !autoMode;
    btnAuto.classList.toggle('active');
});

// Iniciar
loop();

// Aviso de som
setTimeout(() => {
    const hint = document.getElementById('mute-hint');
    hint.style.opacity = 1;
    setTimeout(() => hint.style.opacity = 0, 4000);
}, 1000);

</script>
</body>
</html>
